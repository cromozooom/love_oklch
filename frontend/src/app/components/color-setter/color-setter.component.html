<div
  class="new w-auto flex flex-col border border-gray-300 m-2"
  data-testid="color-setter-component"
>
  <div>
    <div class="flex gap-2 border-b border-b-gray-300 p-2">
      <div
        class="w-6 aspect-square rounded"
        [style.backgroundColor]="colorPreview()"
        data-testid="color-preview"
      ></div>
      <div>
        <small data-testid="display-value">
          {{ currentFormatValue() }}
        </small>
        @if(showColorName() && colorName()) {
        <div class="color-name" data-testid="color-name">
          <span class="color-name-label">{{ colorName()!.name }}</span>
          <small class="color-name-confidence">
            ({{ (colorName()!.confidence * 100).toFixed(0) }}% match)
          </small>
        </div>
        }
      </div>
    </div>
  </div>
  <div class="flex">
    <section class="flex flex-col">
      <button
        *ngFor="let fmt of availableFormats"
        [attr.data-active]="format() === fmt ? 'true' : null"
        [ngClass]="
          format() === fmt
            ? ' xbg-indigo-50 text-indigo-900 border-r border-r-white'
            : 'hover:bg-indigo-100 hover:text-indigo-900 text-indigo-800 border-r border-r-gray-300'
        "
        (click)="switchFormat(fmt)"
        [attr.data-testid]="'format-selector-' + fmt"
        class="p-2 min-w-28 border-b border-b-gray-300"
      >
        {{ getFormatLabel(fmt) }}
      </button>
      <div class="border-r border-r-gray-300 grow"></div>
    </section>
    <main class="grow flex flex-col">
      <div class="editor flex">
        <div class="presets flex flex-col gap-2 p-2 border-r-indigo-500">
          <div
            class="w-52 aspect-square rounded"
            [style.backgroundColor]="colorPreview()"
          ></div>
          <div
            class="w-52 min-h-4 rounded"
            [style.backgroundColor]="colorPreview()"
          ></div>
        </div>
        <!-- Color Input Controls -->
        <div class="color-controls-section">
          <!-- HEX Input -->
          <div *ngIf="format() === 'hex'" class="hex-controls">
            <input
              type="text"
              [(ngModel)]="hexInputValue"
              (change)="onHexChange()"
              (blur)="onHexChange()"
              data-testid="hex-input"
              placeholder="#FF0000"
              class="hex-input"
            />
          </div>

          <!-- RGB Sliders -->
          <div *ngIf="format() === 'rgb'" class="rgb-controls">
            <app-gamut-aware-slider
              label="Red"
              [value]="rgbValues[0]"
              [min]="0"
              [max]="255"
              [step]="1"
              [gradient]="rGradient"
              [validPositions]="[]"
              [formatValue]="formatR"
              testId="rgb-slider-r"
              (valueInput)="rgbValues[0] = $event; onRgbInput()"
              (valueChange)="rgbValues[0] = $event"
              (valueCommit)="onRgbChange()"
            ></app-gamut-aware-slider>

            <app-gamut-aware-slider
              label="Green"
              [value]="rgbValues[1]"
              [min]="0"
              [max]="255"
              [step]="1"
              [gradient]="gGradient"
              [validPositions]="[]"
              [formatValue]="formatG"
              testId="rgb-slider-g"
              (valueInput)="rgbValues[1] = $event; onRgbInput()"
              (valueChange)="rgbValues[1] = $event"
              (valueCommit)="onRgbChange()"
            ></app-gamut-aware-slider>

            <app-gamut-aware-slider
              label="Blue"
              [value]="rgbValues[2]"
              [min]="0"
              [max]="255"
              [step]="1"
              [gradient]="bGradient"
              [validPositions]="[]"
              [formatValue]="formatB"
              testId="rgb-slider-b"
              (valueInput)="rgbValues[2] = $event; onRgbInput()"
              (valueChange)="rgbValues[2] = $event"
              (valueCommit)="onRgbChange()"
            ></app-gamut-aware-slider>

            <div class="rgb-display" data-testid="rgb-display">
              rgb({{ Math.round(rgbValues[0]) }},
              {{ Math.round(rgbValues[1]) }}, {{ Math.round(rgbValues[2]) }})
            </div>
          </div>

          <!-- HSL Sliders -->
          <div *ngIf="format() === 'hsl'" class="hsl-controls">
            <div class="slider-group">
              <label>Hue</label>
              <input
                type="range"
                min="0"
                max="360"
                [(ngModel)]="hslValues[0]"
                (change)="onHslChange()"
                (input)="onHslInput()"
                data-testid="hsl-slider-h"
                class="slider"
              />
              <span class="value-display">{{ Math.round(hslValues[0]) }}°</span>
            </div>

            <div class="slider-group">
              <label>Saturation</label>
              <input
                type="range"
                min="0"
                max="100"
                step="0.1"
                [(ngModel)]="hslValues[1]"
                (change)="onHslChange()"
                (input)="onHslInput()"
                data-testid="hsl-slider-s"
                class="slider"
              />
              <span class="value-display">{{ Math.round(hslValues[1]) }}%</span>
            </div>

            <div class="slider-group">
              <label>Lightness</label>
              <input
                type="range"
                min="0"
                max="100"
                step="0.1"
                [(ngModel)]="hslValues[2]"
                (change)="onHslChange()"
                (input)="onHslInput()"
                data-testid="hsl-slider-l"
                class="slider"
              />
              <span class="value-display">{{ Math.round(hslValues[2]) }}%</span>
            </div>

            <div class="hsl-display" data-testid="hsl-display">
              hsl({{ Math.round(hslValues[0]) }},
              {{ Math.round(hslValues[1]) }}%, {{ Math.round(hslValues[2]) }}%)
            </div>
          </div>

          <!-- LCH Sliders -->
          <app-lch-sliders
            *ngIf="format() === 'lch'"
            [color]="currentFormatValue()"
            [gamut]="gamutDisplayName()"
            (colorChange)="onLchColorChange($event)"
          ></app-lch-sliders>

          <!-- OKLCH Sliders -->
          <app-oklch-sliders
            *ngIf="format() === 'oklch'"
            [color]="currentFormatValue()"
            [gamut]="gamutDisplayName()"
            (colorChange)="onOklchColorChange($event)"
          ></app-oklch-sliders>

          <!-- LAB Sliders -->
          <app-lab-sliders
            *ngIf="format() === 'lab'"
            [color]="currentFormatValue()"
            [gamut]="gamutDisplayName()"
            (colorChange)="onLabColorChange($event)"
          ></app-lab-sliders>

          <!-- Gamut Selector (T066) -->
          <div class="gamut-section">
            <app-gamut-selector
              [selectedGamut]="gamut()"
              [supportedGamuts]="supportedGamuts()"
              (gamutChange)="onGamutChange($event)"
            ></app-gamut-selector>
          </div>

          <!-- Gamut Warning Display (T068) -->
          <div
            *ngIf="!gamutStatus().inGamut"
            class="gamut-warning"
            data-testid="gamut-warning"
          >
            <div class="warning-icon">⚠️</div>
            <div class="warning-content">
              <strong>Out of Gamut</strong>
              <p>{{ gamutStatus().warning }}</p>
              <small *ngIf="gamutStatus().distance">
                Distance from gamut boundary:
                {{ gamutStatus().distance?.toFixed(2) }}
              </small>
            </div>
          </div>
        </div>
      </div>
      <div class="acesibility">
        <!-- WCAG Accessibility Panel -->
        <div *ngIf="showWCAG()" class="wcag-section">
          <app-wcag-panel
            [analysis]="wcagAnalysis()"
            [color]="colorPreview()"
          ></app-wcag-panel>
        </div>
      </div>
    </main>
  </div>
</div>
