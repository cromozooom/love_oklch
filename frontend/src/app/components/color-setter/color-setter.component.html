<div
  class="new w-auto flex flex-col border border-gray-300 dark:border-gray-600 m-2 rounded"
  data-testid="color-setter-component"
  [style.--color]="colorPreview()"
  [style.--ink-color]="inkColor()"
>
  <div>
    <div
      class="flex flex-col justify-between border-b border-b-gray-300 dark:border-b-gray-500"
    >
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-2 py-2">
          <div class="flex items-center pl-2">
            <!-- Ink color demo -->
            <div
              class="ml-2 w-7 h-7 rounded border border-gray-300 dark:border-gray-700 flex items-center justify-center text-xs font-semibold"
              [style.backgroundColor]="'var(--color)'"
              [style.color]="'var(--ink-color)'"
              title="Text with optimal contrast (--ink-color on --color)"
              data-testid="color-preview"
            >
              Aa
            </div>
          </div>
          <div>
            <!-- Display value - shown when not in editing mode -->
            @if (!isEditingColorValue()) {
            <small
              class="flex w-48 px-3 py-2 text-sm border border-transparent rounded-md bg-transparent focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              data-testid="display-value"
              (click)="startEditingColorValue()"
              title="Click to edit color value"
            >
              {{ currentFormatValue() }}
            </small>
            }

            <!-- Color input field - shown when in editing mode -->
            @if (isEditingColorValue()) {
            <div>
              <input
                type="text"
                class="flex w-48 px-3 py-2 text-sm border border-gray-300 rounded-md bg-transparent focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                [class.border-red-500]="colorInputError()"
                [ngModel]="colorInputValue()"
                (ngModelChange)="colorInputValue.set($event)"
                (blur)="onColorInputBlur()"
                (keyup.enter)="onColorInputChange()"
                (keyup.escape)="cancelEditingColorValue()"
                placeholder="try paste any color"
                data-testid="color-input"
                #colorInput
                (focus)="colorInput.select()"
              />
            </div>
            }
            <!-- @if(showColorName() && colorName()) {
            <div class="color-name" data-testid="color-name">
              <span class="color-name-label">{{ colorName()!.name }}</span>
              <small class="color-name-confidence">
                ({{ (colorName()!.confidence * 100).toFixed(0) }}% match)
              </small>
            </div>
            } -->
          </div>
        </div>
        <button
          type="button"
          class="px-2"
          (click)="toggleAccessibilityDetails()"
        >
          {{
            hideAccessibilityDetails()
              ? "Show Accessibility Details"
              : "Hide Accessibility Details"
          }}
        </button>
      </div>
      <!-- Gamut Selector (T066) -->
      <div
        class="gamut-section p-2 border-t border-t-gray-300 dark:border-t-gray-500"
      >
        <app-gamut-selector
          [selectedGamut]="gamut()"
          [supportedGamuts]="supportedGamuts()"
          (gamutChange)="onGamutChange($event)"
        ></app-gamut-selector>
      </div>
      @if (colorInputError()) {
      <div
        class="p-2 border-t border-t-gray-300 text-xs text-red-600 dark:text-red-400"
        data-testid="color-input-error"
      >
        {{ colorInputError() }}
      </div>
      }
    </div>
    <div class="flex">
      <section class="flex flex-col">
        <button
          *ngFor="let fmt of availableFormats"
          [attr.data-active-format]="format() === fmt ? 'true' : null"
          [ngClass]="
            format() === fmt
              ? 'xbg-indigo-50 text-indigo-900 dark:text-indigo-50 border-r border-r-transparent'
              : 'hover:bg-indigo-100 hover:text-indigo-900 text-indigo-800 border-r-gray-300 dark:hover:bg-indigo-900 dark:hover:text-indigo-500 dark:text-indigo-400  dark:border-r-gray-500'
          "
          (click)="switchFormat(fmt)"
          [attr.data-testid]="'format-selector-' + fmt"
          class="p-2 min-w-28 border-b border-b-gray-300 dark:border-b-gray-500 border-r"
        >
          {{ getFormatLabel(fmt) }}
        </button>
        <div
          class="border-r border-r-gray-300 dark:border-r-gray-500 grow"
        ></div>
      </section>
      <main class="grow flex flex-col w-full">
        <div class="editor grow flex w-full">
          <!-- <div class="presets flex flex-col gap-2 p-2 border-r-indigo-500">
          <div
            class="w-52 aspect-square rounded"
            [style.backgroundColor]="colorPreview()"
          ></div>
          <div
            class="w-52 min-h-4 rounded"
            [style.backgroundColor]="colorPreview()"
          ></div>
        </div> -->
          <!-- Color Input Controls -->
          <div class="color-controls-section w-full flex py-3">
            <!-- HEX Input -->
            <app-hex-input
              *ngIf="format() === 'hex'"
              class="flex grow w-full"
              [hexValue]="currentFormatValue()"
              (hexChange)="onHexColorChange($event)"
            ></app-hex-input>

            <!-- RGB Sliders -->
            <app-rgb-sliders
              *ngIf="format() === 'rgb'"
              class="flex grow w-full"
              [color]="currentFormatValue()"
              [gamut]="gamutDisplayName()"
              (colorChange)="onRgbColorChange($event)"
            ></app-rgb-sliders>

            <!-- HSL Sliders -->
            <app-hsl-sliders
              *ngIf="format() === 'hsl'"
              class="flex grow w-full"
              [color]="currentFormatValue()"
              [gamut]="gamutDisplayName()"
              (colorChange)="onHslColorChange($event)"
            ></app-hsl-sliders>

            <!-- LCH Sliders -->
            <app-lch-sliders
              *ngIf="format() === 'lch'"
              class="flex grow w-full"
              [color]="currentFormatValue()"
              [gamut]="gamutDisplayName()"
              (colorChange)="onLchColorChange($event)"
            ></app-lch-sliders>

            <!-- OKLCH Sliders -->
            <app-oklch-sliders
              *ngIf="format() === 'oklch'"
              class="flex grow w-full"
              [color]="currentFormatValue()"
              [gamut]="gamutDisplayName()"
              (colorChange)="onOklchColorChange($event)"
            ></app-oklch-sliders>

            <!-- LAB Sliders -->
            <app-lab-sliders
              *ngIf="format() === 'lab'"
              class="flex grow w-full"
              [color]="currentFormatValue()"
              [gamut]="gamutDisplayName()"
              (colorChange)="onLabColorChange($event)"
            ></app-lab-sliders>
            <!-- Gamut Warning Display (T068) -->
            <div
              *ngIf="!gamutStatus().inGamut"
              class="gamut-warning"
              data-testid="gamut-warning"
            >
              <div class="warning-icon">⚠️</div>
              <div class="warning-content">
                <strong>Out of Gamut</strong>
                <p>{{ gamutStatus().warning }}</p>
                <small *ngIf="gamutStatus().distance">
                  Distance from gamut boundary:
                  {{ gamutStatus().distance?.toFixed(2) }}
                </small>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
    <div class="acesibility" *ngIf="!hideAccessibilityDetails()">
      <!-- WCAG Accessibility Panel -->
      <div *ngIf="wcagAnalysis()" class="wcag-section">
        <app-wcag-panel
          [analysis]="wcagAnalysis()"
          [color]="colorPreview()"
        ></app-wcag-panel>
      </div>
    </div>
  </div>
</div>
